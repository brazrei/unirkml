<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ferramenta para Unir Arquivos .kml</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<body>

<div class="container">
    <h1 class="text-center mt-5">Ferramenta para Unir Arquivos .kml</h1>

    <div class="row justify-content-center mt-5">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">Selecione o arquivo KML 1</h5>
                    <input type="file" class="form-control" id="fileInput1" accept=".kml">
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">Selecione o arquivo KML 2</h5>
                    <input type="file" class="form-control" id="fileInput2" accept=".kml">
                </div>
            </div>
        </div>
    </div>

    <div class="text-center mt-3">
        <button class="btn btn-primary" onclick="unirArquivosKML()">Unir Arquivos</button>
    </div>
</div>

<!-- Modal para mostrar mensagem de sucesso -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="successModalLabel">Sucesso!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Arquivo salvo na pasta Downloads! 
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script></head>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
function unirArquivosKML() {
    const fileInput1 = document.getElementById('fileInput1');
    const fileInput2 = document.getElementById('fileInput2');

    const reader1 = new FileReader();
    reader1.onload = function(event) {
        const fileContent1 = event.target.result;

        const reader2 = new FileReader();
        reader2.onload = function(event) {
            const fileContent2 = event.target.result;

            const parser = new DOMParser();
            const xmlDoc1 = parser.parseFromString(fileContent1, 'text/xml');
            const xmlDoc2 = parser.parseFromString(fileContent2, 'text/xml');

            const placemarkElements1 = xmlDoc1.getElementsByTagName('Placemark');
            const placemarkElements2 = xmlDoc2.getElementsByTagName('Placemark');

            for (let i = 0; i < placemarkElements2.length; i++) {
                const placemark = xmlDoc1.createElement('Placemark');
                placemark.innerHTML = placemarkElements2[i].innerHTML;
                xmlDoc1.documentElement.appendChild(placemark);
            }

            const serializer = new XMLSerializer();
            const combinedKMLContent = serializer.serializeToString(xmlDoc1);

            const combinedBlob = new Blob([combinedKMLContent], { type: 'application/vnd.google-earth.kml+xml' });
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(combinedBlob);
            downloadLink.download = 'arquivo_saida.kml';

            // Exibir modal de sucesso após o download começar
            $('#successModal').modal('show');
            // Ocultar modal após 2 segundos
            setTimeout(function() {
                $('#successModal').modal('hide');
            }, 5000);

            downloadLink.click();
        };
        reader2.readAsText(fileInput2.files[0]);
    };
    reader1.readAsText(fileInput1.files[0]);
}
</script>

</body>
</html>
